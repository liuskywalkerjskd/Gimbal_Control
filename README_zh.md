# Gimbal Control - 三维可视化系统

中文版 | [English](./README.md)

## 概述

Gimbal Control 是一个交互式三维可视化系统，用于模拟带有实时逆运动学（IK）计算的云台稳定系统。该工具提供了一个全面的平台，用于理解和测试各种条件下的云台行为，包括动态基座扰动和俯仰角约束。

## 功能特性

- **实时三维可视化**：基于 matplotlib 的交互式 3D 渲染，支持自定义视角
- **逆运动学求解器**：自动计算云台关节角度以实现目标姿态
- **动态基座仿真**：使用正弦波扰动模拟平台运动
- **俯仰限制约束**：可配置的俯仰角限制，带有视觉反馈
- **交互式控制**：
  - 实时滑块调整目标和基座姿态（偏航、俯仰、横滚）
  - 重置按钮恢复初始状态
  - 正弦波模式用于自动基座运动仿真
- **视觉反馈**：
  - 颜色编码的状态指示器（最优/受限状态）
  - 显示传感器运动历史的轨迹
  - 显示目标姿态的虚影叠加
  - 从传感器发出的光束投影
  - 多个坐标系显示（世界坐标系、基座坐标系、偏航关节坐标系、传感器坐标系）
- **性能指标**：实时显示跟踪误差和关节状态

## 技术细节

### 云台配置
- 双轴云台系统（偏航 + 俯仰）
- 可配置的连杆长度（`L_BY`、`L_YP`）
- 默认俯仰限制：±45 度
- 传感器可视化为三维长方体

### 坐标系
- **世界坐标系**：全局参考坐标系
- **基座坐标系**：平台/载具参考坐标系
- **偏航关节坐标系**：第一旋转轴
- **传感器坐标系**：末端执行器坐标系（驱动姿态）

### 数学模型
系统实现了几何逆运动学解：
1. 将目标姿态从世界坐标系转换到基座坐标系
2. 使用反正切函数计算偏航角和俯仰角
3. 应用俯仰约束以确保遵守机械限制
4. 所有旋转使用 ZYX 欧拉角约定

## 安装

### 前置要求
- Python 3.7+
- pip（Python 包管理器）

### 依赖项
```bash
pip install matplotlib numpy scipy
```

### 快速开始
```bash
# 克隆仓库
git clone https://github.com/liuskywalkerjskd/Gimbal_Control.git
cd Gimbal_Control

# 安装依赖
pip install -r requirements.txt  # 或手动安装: pip install matplotlib numpy scipy

# 运行可视化程序
python axis-visual.py
```

## 使用说明

### 基本操作
1. **启动应用程序**：运行 `python axis-visual.py`
2. **调整目标姿态**：使用顶部滑块（青色）设置期望的传感器姿态
3. **调整基座姿态**：使用中间滑块（橙色）设置平台姿态
4. **查看系统状态**：检查右侧面板查看关节角度、误差和状态

### 交互功能

#### 滑块
- **目标姿态**（青色）：
  - `Yaw（偏航）`：-180° 至 +180°
  - `Pitch（俯仰）`：-90° 至 +90°
  - `Roll（横滚）`：-180° 至 +180°
- **基座姿态**（橙色）：
  - `Yaw（偏航）`：-180° 至 +180°
  - `Pitch（俯仰）`：-90° 至 +90°
  - `Roll（横滚）`：-180° 至 +180°

#### 按钮
- **RESET（重置）**：将所有角度恢复为零
- **SINE WAVE（正弦波）**：切换自动基座运动仿真
  - 创建真实的平台扰动
  - 振幅：15°（可配置）
  - 频率：1 Hz（可配置）

#### 视觉指示器
- **绿色状态**：系统在限制范围内运行
- **红色状态**：达到俯仰限制
- **青色连杆**：正常运行
- **红色连杆**：俯仰约束激活
- **黄色轨迹**：最近的运动路径
- **虚影传感器**：目标姿态叠加

### 配置

编辑 `axis-visual.py` 中的 `CONFIG` 字典进行自定义：
```python
CONFIG = {
    'L_BY': 1.5,              # 基座到偏航关节的长度
    'L_YP': 1.5,              # 偏航关节到俯仰/传感器的长度
    'PITCH_LIMIT': 45.0,      # 最大俯仰角（度）
    'SENSOR_SIZE': [0.6, 0.4, 0.3],  # 传感器尺寸 [长, 宽, 高]
    'WAVE_AMP': 15.0,         # 正弦波振幅（度）
    'WAVE_FREQ': 1.0,         # 正弦波频率（Hz）
    'COLORS': { ... }         # 颜色方案
}
```

## 应用场景

- **教育**：学习云台机制和逆运动学
- **系统设计**：评估云台配置和约束
- **控制测试**：验证稳定算法
- **性能分析**：评估扰动下的跟踪精度
- **可视化**：创建云台行为演示

## 技术说明

### 旋转约定
- 使用 ZYX 欧拉角（偏航-俯仰-横滚）
- 用户界面中所有角度以度为单位
- 内部计算使用弧度
- 使用 scipy.spatial.transform.Rotation 计算旋转矩阵

### 坐标系统
- 右手坐标系
- Z 轴：向上
- X 轴：向前
- Y 轴：向左

### 性能
- 动画刷新率：50ms（20 FPS）
- 轨迹历史：最后 50 个位置
- 优化用于实时交互

## 文件结构

```
Gimbal_Control/
├── axis-visual.py          # 主可视化应用程序
├── Gimbal_Control _V1.1.pdf  # 文档（中文）
├── README.md               # 英文版说明
└── README_zh.md            # 本文件（中文版）
```

## 贡献

欢迎贡献！请随时提交问题或拉取请求。

## 许可证

本项目可用于教育和研究目的。

## 作者

由 liuskywalkerjskd 创建

## 参考资料

- [云台控制文档（中文）](./Gimbal_Control%20_V1.1.pdf)

---

查看英文版说明，请访问 [README.md](./README.md)
